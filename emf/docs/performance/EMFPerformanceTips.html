<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>EMF Performance Tips</title>
</head>

<body lang="EN-US" xml:lang="EN-US">

<h1>EMF Performance Tips</h1>

<p>
Last updated: July 6, 2005
</p>

<p>
Authors: Dave Steinberg, Elena Litani
</p>

<h2>Reduce memory footprint of EMF models using boolean flags</h2>

<p>The generator provides an option to combine boolean flags into an <tt class="code">int</tt> field in class implementations.  This applies to the values of boolean attributes and the flags representing whether unsettable features are set.  This can significantly reduce the memory consumed by instances of models with classes containing a number of such features.  To enable this option, specify a field name in the "Boolean Flags Field" property, under "Model Feature Defaults", of a generator model.
</p>

<p>The "Boolean Flags Reserved Bits" property can be used to indicate that the <tt class="code">int</tt> field is actually inherited from a base object implementation, and to specify the number of bits reserved for use by the base.  For example, <tt class="code">Ecore</tt> uses eFlags, which is defined on <tt class="code">EObjectImpl</tt>, for its boolean flags, with 8 bits reserved for the base.  Note that, though it's unlikely that <tt class="code">EObjectImpl</tt> will require more than 8 bits of this field, we do reserve the right to break compatibility by exceeding this number, if necessary.  So, it is safer to use a separate <tt class="code">int</tt> field for the boolean flags in your model, which can still yield substantial memory savings.
</p>

<h2>Improve performance of save and load operations</h2>

<p>The following options (specified on <tt class="code">org.eclipse.emf.ecore.xmi.XMLResource</tt>) can be used on <tt class="code">load(InputStream, Map)</tt> and <tt class="code">save(OutputStream, Map)</tt>  to improve the performance of the save or load operation, by decreasing either the running time of the operation or the amount of memory it uses.
</p>

<h3>Load options</h3>

<p><tt class="code">OPTION_DEFER_IDREF_RESOLUTION</tt></p>

<p>Option value: <tt class="code">Boolean</tt>.</p>

<p>This option can be enabled to defer resolving references within a resource until the whole document has been parsed. The default strategy is to try to resolve each reference as it is encountered and then, at the end, resolve any ones that failed. This wastes time looking up forward references that do not exist yet, which, if you're using intrinsic IDs, can involve iterating over every object in the resource.
</p>

<p><tt class="code">OPTION_USE_PARSER_POOL</tt></p>

<p>Option value: <tt class="code">org.eclipse.emf.ecore.xmi.XMLParserPool</tt>.
</p>

<p>We <b>strongly encourage</b> to set this option for EMF load operation.
This option is used to provide a parser pool, from which <tt class="code">SAXParser</tt> instances are created and reused. <tt class="code">XMLParserPool</tt> defines a simple interface for obtaining and releasing parsers based on their features and properties. Specifying a parser pool, such as an instance of the default implementation, <tt class="code">XMLParserPoolImpl</tt>, can improve performance <b>dramatically</b> when a resource performs repeated loads. A single parser pool can also be shared among multiple resources. Default implementation is also thread-safe.
</p>

<p><tt class="code">OPTION_USE_XML_NAME_TO_FEATURE_MAP</tt></p>

<p>Option value: <tt class="code">java.util.Map</tt>.</p>

<p>This option can be used to share the cache of mappings between qualified XML names (namespace + local name) and corresponding <tt class="code">Ecore</tt> features across invocations of <tt class="code">load()</tt>, or even among resources. It can take some time to determine these associations, since they can be affected by <tt class="code">ExtendedMetaData</tt> or an <tt class="code">XMLMap</tt>, so they are cached during a load.  If you use this option to specify the same map for several loads, that instance will be used as the cache, improving the performance for all but the first. You can share a single map among multiple resources, unless they load different models with conflicting qualified names.</p>

<h3>Save options</h3>

<p><tt class="code">OPTION_FLUSH_THRESHOLD</tt></p>

<p>Option value: <tt class="code">Integer</tt>.</p>

<p>This option can be used to specify a maximum number of characters to allow in the output stream before flushing it. This reduces the memory used in serializing a large file, but it is slower than the default behavior.
</p>

<p><tt class="code">OPTION_USE_CACHED_LOOKUP_TABLE</tt></p>

<p>Option value: <tt class="code">List</tt>.</p>

<p>This option provides a placeholder to cache information about structure of the model. (using qualified XML names as a key for caching information). When possible, the same placeholder list should be shared among resources, unless you intent to serialize instances of different models.
</p>

<p><tt class="code">OPTION_CONFIGURATION_CACHE</tt>
</p>
<p>Option value: <tt class="code">Boolean</tt>.
</p>
<p>This option can be enabled to cache and reuse generic data in repeated save operations, avoiding the cost of reinitializing the data. This option is save to use when serializing instances of the same model.
</p>

<p><tt class="code">OPTION_FORMATTED</tt>
</p>
<p>Option value: <tt class="code">Boolean</tt>.
</p>
<p>This option is used to disable formatting of documents, omitting whitespaces and line brakes, to improve the performance of saving and, subsequently, loading the resulting document. This means fewer bytes have to be written and read, but the serialization will be less human-readable.
</p>

<p><tt class="code">OPTION_USE_FILE_BUFFER</tt>
</p>
<p>Option value: <tt class="code">Boolean</tt>.
</p>
<p>This option can be enabled to accumulate output during serialization in a temporary file, rather than an in-memory buffer. This reduces the memory used in serializing a large file, but it is slower than the default behavior.
</p>

</body>
</html>