<project name="apitask" basedir="." default="run">
    <property name="eclipse.install.dir" value="/opt/public/modeling/emft/facet/buckminsterx86/install/plugins"/>
    <property name="eclipse.lib.dir" value="libs"/>
    <property name="task.props" value="libs/api-tasks.properties"/>
    <property name="report.loc" value="/opt/users/hudsonbuild/workspace/emffacet-nightly/api_report/xml"/>
    <property name="html.loc" value="/opt/users/hudsonbuild/workspace/emffacet-nightly/api_report/html"/>
    <property name="scope.loc" value="/opt/users/hudsonbuild/workspace/emffacet-nightly/swtbot/install/plugins"/>
 
    <target name="init" depends="extract-apitoolingjar">
	<taskdef file="${task.props}">
	    <classpath>
	    <fileset dir="${eclipse.install.dir}">
	        <include name="*.jar"/>
	    </fileset>
	    <fileset dir="${eclipse.lib.dir}">
	        <include name="*.jar"/>
	    </fileset>
	    </classpath>
	</taskdef>
    </target>
    <target name="extract-apitoolingjar">
	<unjar overwrite="true" dest="${eclipse.lib.dir}">
	    <fileset dir="${eclipse.install.dir}">
	        <include name="org.eclipse.pde.api.tools_*.jar"/>
	    </fileset>
	    <patternset>
	        <include name="**/*.jar"/>
	    </patternset>
	</unjar>
	<move file="${eclipse.lib.dir}/lib/apitooling-ant.jar" 
              overwrite="true" todir="${eclipse.lib.dir}"/>
	<delete dir="${eclipse.lib.dir}/lib/" includeemptydirs="true"/>
    </target>
    <target name="run" depends="init">
	<apiuse
    	    location="${scope.loc}"
	    report="${report.loc}"
	    referencepattern=".*"
	    scopepattern="org\.eclipse\.emf\.facet\..*"
	    considerinternal="true"
	    debug="true"
	/>
	<apiuse_reportconversion
	    xmlfiles="${report.loc}"
	    htmlfiles="${html.loc}"
	    debug="true"
	/>
    </target>
</project>